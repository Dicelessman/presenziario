<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scout Maori - Presenziario</title>
  <meta name="description" content="Registro presenze Reparto Scout Maori" />
  <meta name="theme-color" content="#16a34a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Scout Maori" />
  <link rel="icon" href='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"%3E%3Cdefs/%3E%3Crect width="64" height="64" rx="12" ry="12" fill="%2316a34a"/%3E%3Ctext x="50%25" y="52%25" text-anchor="middle" font-family="Arial, Helvetica, sans-serif" font-size="34" fill="white" font-weight="700"%3EM%3C/text%3E%3C/svg%3E' />
  <link rel="stylesheet" href="style.css" />
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js + Datalabels -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
  <!-- Firebase Auth -->
  <script type="module" src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js"></script>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">
  <div id="app" class="max-w-4xl mx-auto w-full bg-white shadow-lg rounded-xl overflow-hidden my-4">
    <!-- Header -->
    <header class="bg-green-700 text-white p-6 rounded-t-xl flex justify-between items-center">
      <div class="flex flex-col">
        <h1 class="text-3xl font-bold">Scout Maori</h1>
        <p class="text-green-200 mt-1">Registro Presenze</p>
      </div>
      <div id="staff-info" class="text-right">
        <span class="text-green-200">Staff Selezionato:</span>
        <span id="selectedStaffName" class="font-semibold">Nessuno</span>
      </div>
      <span id="loggedInUserEmail" class="text-white text-lg"></span>
      <button type="button" id="logoutButton" class="btn-danger" style="display:none;">Logout</button>
    </header>
    <nav id="desktopNav" class="bg-green-600 p-2 hidden md:flex justify-center space-x-4">
      <button type="button" class="tab-btn p-2 rounded-lg text-white hover:bg-green-700" data-tab="dashboard">Dashboard</button>
      <button type="button" class="tab-btn p-2 rounded-lg text-white hover:bg-green-700" data-tab="calendar">Calendario</button>
      <button type="button" class="tab-btn p-2 rounded-lg text-white hover:bg-green-700" data-tab="scouts">Esploratori</button>
      <button type="button" class="tab-btn p-2 rounded-lg text-white hover:bg-green-700" data-tab="staff">Staff</button>
      <button type="button" class="tab-btn p-2 rounded-lg text-white hover:bg-green-700" data-tab="presences">Presenze</button>
      <button type="button" class="tab-btn p-2 rounded-lg text-white hover:bg-green-700" data-tab="auditLogs">Log Audit</button>
    </nav>

    <!-- Nav (Hamburger) -->
    <nav id="hamburgerMenu" class="md:hidden">
      <button class="hamburger-icon text-white p-3">&#9776;</button>
      <div class="nav-links space-y-2">
        <button type="button" class="tab-btn p-2 rounded-lg text-white hover:bg-green-800" data-tab="dashboard">Dashboard</button>
        <button type="button" class="tab-btn p-2 rounded-lg text-white hover:bg-green-800" data-tab="calendar">Calendario</button>
        <button type="button" class="tab-btn p-2 rounded-lg text-white hover:bg-green-800" data-tab="scouts">Esploratori</button>
        <button type="button" class="tab-btn p-2 rounded-lg text-white hover:bg-green-800" data-tab="staff">Staff</button>
        <button type="button" class="tab-btn p-2 rounded-lg text-white hover:bg-green-800" data-tab="presences">Presenze</button>
        <button type="button" class="tab-btn p-2 rounded-lg text-white hover:bg-green-800" data-tab="auditLogs">Log Audit</button>
      </div>
    </nav>

    <!-- Main -->
    <main class="p-6">
      <!-- Modali -->
      <div id="staffSelectionModal" class="modal">
        <div class="modal-content max-w-lg mx-auto">
          <h4 class="text-xl font-semibold text-gray-700">Seleziona un membro dello Staff</h4>
          <p class="text-gray-600 mb-4">Seleziona uno staff per abilitare le modifiche.</p>
          <div id="staffListForSelection" class="space-y-2"></div>
        </div>
      </div>

      <div id="editStaffModal" class="modal">
        <div class="modal-content max-w-sm mx-auto">
          <h4 class="text-xl font-semibold text-gray-700">Modifica Membro Staff</h4>
          <form id="editStaffForm" class="space-y-4">
            <input type="hidden" id="editStaffId" />
            <div>
              <label for="editStaffNome" class="block text-sm font-medium text-gray-700">Nome</label>
              <input id="editStaffNome" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
            </div>
            <div>
              <label for="editStaffCognome" class="block text-sm font-medium text-gray-700">Cognome</label>
              <input id="editStaffCognome" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
            </div>
            <div class="flex gap-2 justify-end">
              <button type="button" onclick="window.UI.closeModal('editStaffModal')" class="btn-secondary">Annulla</button>
              <button class="btn-primary">Salva</button>
            </div>
          </form>
        </div>
      </div>

      <div id="confirmDeleteStaffModal" class="modal">
        <div class="modal-content max-w-sm mx-auto text-center">
          <h4 class="text-xl font-semibold text-gray-700">Conferma Eliminazione Staff</h4>
          <p class="text-gray-600 mb-4">Eliminare <span id="staffNameToDelete" class="font-semibold text-red-600"></span>?</p>
          <div class="flex gap-2 justify-center">
            <button onclick="window.UI.closeModal('confirmDeleteStaffModal')" class="btn-secondary">Annulla</button>
            <button id="confirmDeleteStaffButton" class="btn-danger">Elimina</button>
          </div>
        </div>
      </div>

      <div id="editScoutModal" class="modal">
        <div class="modal-content max-w-sm mx-auto">
          <h4 class="text-xl font-semibold text-gray-700">Modifica Esploratore</h4>
          <form id="editScoutForm" class="space-y-4">
            <input type="hidden" id="editScoutId" />
            <div>
              <label for="editScoutNome" class="block text-sm font-medium text-gray-700">Nome</label>
              <input id="editScoutNome" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
            </div>
            <div>
              <label for="editScoutCognome" class="block text-sm font-medium text-gray-700">Cognome</label>
              <input id="editScoutCognome" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
            </div>
            <div class="flex gap-2 justify-end">
              <button type="button" onclick="window.UI.closeModal('editScoutModal')" class="btn-secondary">Annulla</button>
              <button class="btn-primary">Salva</button>
            </div>
          </form>
        </div>
      </div>

      <div id="confirmDeleteScoutModal" class="modal">
        <div class="modal-content max-w-sm mx-auto text-center">
          <h4 class="text-xl font-semibold text-gray-700">Conferma Eliminazione Esploratore</h4>
          <p class="text-gray-600 mb-4">Eliminare <span id="scoutNameToDelete" class="font-semibold text-red-600"></span>? Verranno rimosse anche le presenze associate.</p>
          <div class="flex gap-2 justify-center">
            <button onclick="window.UI.closeModal('confirmDeleteScoutModal')" class="btn-secondary">Annulla</button>
            <button id="confirmDeleteScoutButton" class="btn-danger">Elimina</button>
          </div>
        </div>
      </div>

      <!-- Tabs -->
      <section id="presenzeTab" class="tab-content active">
        <h2 class="text-2xl font-semibold text-gray-700 mb-4">Registro Presenze</h2>
        <div class="mobile-only flex items-center gap-2 mb-3">
          <button id="mobileActivityPrev" class="btn-secondary px-3 py-2">◀</button>
          <select id="mobileActivityPicker" class="flex-1 rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200"></select>
          <button id="mobileActivityNext" class="btn-secondary px-3 py-2">▶</button>
        </div>
        <div id="presenceTableContainer" class="overflow-x-auto rounded-lg shadow-sm">
          <table class="presence-table bg-white">
            <thead>
              <tr id="tableHeaderDates">
                <th rowspan="2" class="sticky left-0 !bg-green-700 !text-white !p-4 text-left">Esploratore</th>
              </tr>
              <tr id="tableHeaderNames"></tr>
            </thead>
            <tbody id="presenceTableBody"></tbody>
          </table>
        </div>
      </section>

      <section id="dashboardTab" class="tab-content">
        <h2 class="text-2xl font-semibold text-gray-700 mb-4">Dashboard & Statistiche</h2>
        <div class="space-y-6">
          <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Presenza per Esploratore</h3>
            <canvas id="scoutPresenceChart"></canvas>
          </div>
          <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Presenze per Attività</h3>
            <canvas id="activityPresenceChart"></canvas>
          </div>
        </div>
      </section>

      <section id="calendarTab" class="tab-content">
        <h2 class="text-2xl font-semibold text-gray-700 mb-4">Calendario Attività</h2>
        <div class="grid md:grid-cols-2 gap-6">
          <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Aggiungi Nuova Attività</h3>
            <form id="addActivityForm" class="space-y-4">
              <div>
                <label for="activityTipo" class="block text-sm font-medium text-gray-700">Tipo</label>
                <select id="activityTipo" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200">
                  <option value="Riunione">Riunione</option>
                  <option value="Attività lunga">Attività lunga</option>
                  <option value="Uscita">Uscita</option>
                  <option value="Campo">Campo</option>
                </select>
              </div>
              <div>
                <label for="activityData" class="block text-sm font-medium text-gray-700">Data</label>
                <input id="activityData" type="date" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
              </div>
              <div>
                <label for="activityDescrizione" class="block text-sm font-medium text-gray-700">Descrizione</label>
                <input id="activityDescrizione" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
              </div>
              <div>
                <label for="activityCosto" class="block text-sm font-medium text-gray-700">Costo (€)</label>
                <input id="activityCosto" type="number" min="0" step="0.01" placeholder="0" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
              </div>
              <button class="btn-primary w-full">Crea Attività</button>
            </form>
          </div>

          <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Prossime Attività</h3>
            <div id="calendarList" class="space-y-2"></div>
          </div>
        </div>
      </section>

      <!-- Modale Modifica Attività -->
      <div id="editActivityModal" class="modal">
        <div class="modal-content max-w-sm mx-auto">
          <h4 class="text-xl font-semibold text-gray-700">Modifica Attività</h4>
          <form id="editActivityForm" class="space-y-4">
            <input type="hidden" id="editActivityId" />
            <div>
              <label for="editActivityTipo" class="block text-sm font-medium text-gray-700">Tipo</label>
              <select id="editActivityTipo" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200">
                <option value="Riunione">Riunione</option>
                <option value="Attività lunga">Attività lunga</option>
                <option value="Uscita">Uscita</option>
                <option value="Campo">Campo</option>
              </select>
            </div>
            <div>
              <label for="editActivityData" class="block text-sm font-medium text-gray-700">Data</label>
              <input id="editActivityData" type="date" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
            </div>
            <div>
              <label for="editActivityDescrizione" class="block text-sm font-medium text-gray-700">Descrizione</label>
              <input id="editActivityDescrizione" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
            </div>
            <div>
              <label for="editActivityCosto" class="block text-sm font-medium text-gray-700">Costo (€)</label>
              <input id="editActivityCosto" type="number" min="0" step="0.01" placeholder="0" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
            </div>
            <div class="flex gap-2 justify-end">
              <button type="button" onclick="window.UI.closeModal('editActivityModal')" class="btn-secondary">Annulla</button>
              <button class="btn-primary">Salva</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modale Conferma Eliminazione Attività -->
      <div id="confirmDeleteActivityModal" class="modal">
        <div class="modal-content max-w-sm mx-auto text-center">
          <h4 class="text-xl font-semibold text-gray-700">Conferma Eliminazione Attività</h4>
          <p class="text-gray-600 mb-4">Eliminare <span id="activityInfoToDelete" class="font-semibold text-red-600"></span>?</p>
          <div class="flex gap-2 justify-center">
            <button onclick="window.UI.closeModal('confirmDeleteActivityModal')" class="btn-secondary">Annulla</button>
            <button id="confirmDeleteActivityButton" class="btn-danger">Elimina</button>
          </div>
        </div>
      </div>

      <!-- Login Modal -->
      <div id="loginModal" class="modal show">
        <div class="modal-content max-w-sm mx-auto">
          <h4 class="text-xl font-semibold text-gray-700">Accedi all'App</h4>
          <form id="loginForm" class="space-y-4">
            <div>
              <label for="loginEmail" class="block text-sm font-medium text-gray-700">Email</label>
              <input id="loginEmail" type="email" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
            </div>
            <div>
              <label for="loginPassword" class="block text-sm font-medium text-gray-700">Password</label>
              <input id="loginPassword" type="password" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
            </div>
            <button type="submit" class="btn-primary w-full">Accedi</button>
            <p id="loginError" class="text-red-500 text-sm text-center"></p>
          </form>
        </div>
      </div>

      <section id="staffTab" class="tab-content">
        <h2 class="text-2xl font-semibold text-gray-700 mb-4">Gestione Staff</h2>
        <div class="space-y-6">
          <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Aggiungi Membro Staff</h3>
            <form id="addStaffForm" class="space-y-4">
              <div>
                <label for="staffNome" class="block text-sm font-medium text-gray-700">Nome</label>
                <input id="staffNome" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
              </div>
              <div>
                <label for="staffCognome" class="block text-sm font-medium text-gray-700">Cognome</label>
                <input id="staffCognome" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
              </div>
              <button class="btn-primary w-full">Aggiungi Staff</button>
            </form>
          </div>

          <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Membri Staff</h3>
            <div id="staffList" class="space-y-2"></div>
          </div>
        </div>
      </section>

      <section id="scoutsTab" class="tab-content">
        <h2 class="text-2xl font-semibold text-gray-700 mb-4">Gestione Esploratori</h2>
        <div class="space-y-6">
          <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Aggiungi Nuovo Esploratore</h3>
            <form id="addScoutForm" class="space-y-4">
              <div>
                <label for="scoutNome" class="block text-sm font-medium text-gray-700">Nome</label>
                <input id="scoutNome" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
              </div>
              <div>
                <label for="scoutCognome" class="block text-sm font-medium text-gray-700">Cognome</label>
                <input id="scoutCognome" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-200" />
              </div>
              <button class="btn-primary w-full">Aggiungi Esploratore</button>
            </form>
          </div>
          <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Lista Esploratori</h3>
            <div id="scoutsList" class="space-y-2"></div>
          </div>
        </div>
      </section>
      <section id="auditLogsTab" class="tab-content">
        <h2 class="text-2xl font-semibold text-gray-700 mb-4">Log di Audit</h2>
        <div id="auditLogsContent" class="bg-gray-50 p-6 rounded-lg shadow-inner"></div>
      </section>
    </main>
  </div>

  <!-- App -->
  <script type="module" src="app.js"></script>
</body>
</html>
